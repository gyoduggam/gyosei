<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>행정서사 합격 관리 대시보드</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Chosen Palette: Calm Focus -->
    <!-- Application Structure Plan: 이 어플리케이션은 사용자의 일일 학습 흐름에 최적화된 '대시보드 중심 구조'로 설계되었습니다. 메인 화면에서는 '오늘의 복습' 항목을 최우선으로 보여주어 매일 해야 할 가장 중요한 작업을 명확히 제시합니다. 하단에는 학습 진행 상황을 직관적으로 파악할 수 있는 차트들을 배치하여 동기를 부여합니다. 사용자는 상단 탭을 통해 언제든지 '단권화 노트'나 '오답 노트'의 전체 목록을 조회하거나 새로운 내용을 추가할 수 있습니다. 이는 보고서의 선형적 구조를 따르기보다, '오늘 할 일 확인 → 학습 수행 → 진행 상황 점검 → 기록 및 관리'라는 실제 학습 사이클에 맞춘 사용자 중심의 비선형적이고 효율적인 구조입니다. -->
    <!-- Visualization & Content Choices:
        - Report Info: 과목별 학습량 -> Goal: 학습 분량 비교 -> Viz/Presentation: 도넛 차트 (Chart.js) -> Interaction: 호버 시 툴팁으로 수치 확인 -> Justification: 전체 학습에서 각 과목이 차지하는 비중을 한눈에 파악하여 균형 있는 학습 계획 수립을 도움.
        - Report Info: 과목별 오답 수 -> Goal: 취약점 파악 -> Viz/Presentation: 막대 차트 (Chart.js) -> Interaction: 호버 시 툴팁으로 수치 확인 -> Justification: 어떤 과목에 더 집중해야 하는지 명확하게 시각화하여 전략적 학습을 유도.
        - Report Info: 일별 복습 완료 수 -> Goal: 학습 꾸준함 추적 -> Viz/Presentation: 라인 차트 (Chart.js) -> Interaction: 호버 시 툴팁으로 수치 확인 -> Justification: 매일의 복습 성과를 그래프로 보여주어 학습 습관 형성을 격려하고 성취감을 제공.
        - Report Info: 단권화/오답 노트 목록 -> Goal: 정보 정리 및 조회 -> Viz/Presentation: 동적 테이블 (HTML/CSS/JS) -> Interaction: 검색, 필터링, 상세 보기 -> Justification: 방대한 학습 내용을 효율적으로 관리하고 필요할 때 신속하게 찾아볼 수 있도록 지원.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body { font-family: 'Inter', 'Pretendard', sans-serif; background-color: #FDFBF7; }
        .chart-container { position: relative; width: 100%; max-width: 600px; margin-left: auto; margin-right: auto; height: 300px; max-height: 350px; }
        @media (min-width: 768px) { .chart-container { height: 320px; } }
        .tab-button { transition: all 0.3s ease; }
        .tab-button.active { color: #A37E63; border-color: #A37E63; font-weight: 600; }
        .modal-backdrop { background-color: rgba(0,0,0,0.5); }
        .modal-content-area {
            max-height: 80vh; /* 화면 높이의 80%를 넘지 않도록 제한 */
            overflow-y: auto; /* 내용이 넘치면 스크롤바 생성 */
            padding-right: 1rem; /* 스크롤바 때문에 내용이 잘리는 것 방지 */
        }
        .scroll-area { max-height: calc(100vh - 250px); }
    </style>
    <link rel="stylesheet" as="style" crossorigin href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
</head>
<body class="text-gray-800">

    <!-- Main Container -->
    <div class="container mx-auto p-4 md:p-6">

        <!-- Header -->
        <header class="text-center mb-6">
            <h1 class="text-3xl md:text-4xl font-bold text-[#A37E63]">행정서사 합격 관리 시스템</h1>
            <p id="d-day-counter" class="text-lg text-gray-600 mt-2"></p>
        </header>

        <!-- Main Content -->
        <main>
            <!-- Navigation Tabs -->
            <div class="mb-6 border-b border-gray-200">
                <nav class="flex -mb-px space-x-6" aria-label="Tabs">
                    <button onclick="changeTab('dashboard')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-[#A37E63] hover:border-[#A37E63] active" data-tab="dashboard">
                        대시보드
                    </button>
                    <button onclick="changeTab('notes')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-[#A37E63] hover:border-[#A37E63]" data-tab="notes">
                        단권화 노트
                    </button>
                    <button onclick="changeTab('errors')" class="tab-button whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-[#A37E63] hover:border-[#A37E63]" data-tab="errors">
                        오답 노트
                    </button>
                </nav>
            </div>

            <!-- Tab Content -->
            <div id="tab-content">
                <!-- Dashboard -->
                <div id="dashboard" class="space-y-8">
                    <section>
                        <h2 class="text-2xl font-semibold mb-4 text-[#B5947C]">📝 오늘의 복습</h2>
                        <div id="today-review-list" class="space-y-3">
                            <!-- Today's review items will be injected here -->
                        </div>
                    </section>

                    <section class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                        <div>
                            <h2 class="text-2xl font-semibold mb-4 text-center text-[#B5947C]">📊 과목별 학습 현황</h2>
                            <div class="chart-container"><canvas id="subjectChart"></canvas></div>
                        </div>
                        <div>
                            <h2 class="text-2xl font-semibold mb-4 text-center text-[#B5947C]">📉 과목별 오답 수</h2>
                            <div class="chart-container"><canvas id="errorChart"></canvas></div>
                        </div>
                        <div class="lg:col-span-2">
                             <h2 class="text-2xl font-semibold mb-4 text-center text-[#B5947C]">📈 일별 복습 기록</h2>
                            <div class="chart-container"><canvas id="reviewHistoryChart"></canvas></div>
                        </div>
                    </section>
                </div>

                <!-- Notes -->
                <div id="notes" class="hidden space-y-4">
                    <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-semibold text-[#B5947C]">� 단권화 노트 목록</h2>
                        <button onclick="openModal('note-modal')" class="bg-[#A37E63] text-white px-4 py-2 rounded-lg shadow hover:bg-[#8e6a51] transition">새 노트 추가</button>
                    </div>
                    <div id="notes-list" class="scroll-area overflow-y-auto bg-white/50 p-4 rounded-lg"></div>
                </div>

                <!-- Errors -->
                <div id="errors" class="hidden space-y-4">
                     <div class="flex justify-between items-center">
                        <h2 class="text-2xl font-semibold text-[#B5947C]">🧐 오답 노트 목록</h2>
                        <button onclick="openModal('error-modal')" class="bg-[#A37E63] text-white px-4 py-2 rounded-lg shadow hover:bg-[#8e6a51] transition">새 오답 추가</button>
                    </div>
                    <div id="errors-list" class="scroll-area overflow-y-auto bg-white/50 p-4 rounded-lg"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- Note Modal -->
    <div id="note-modal" class="fixed inset-0 z-50 modal-backdrop hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl">
            <form id="note-form" class="p-6 space-y-4">
                <h3 class="text-xl font-bold text-[#A37E63]">단권화 노트 작성</h3>
                <div class="modal-content-area"> <!-- Scrollable content area -->
                    <input type="hidden" id="note-id">
                    <select id="note-subject" class="w-full p-2 border rounded-md" required>
                        <option value="">과목 선택</option>
                        <option>헌법</option> <option>행정법</option> <option>민법</option> <option>상법</option> <option>기초법학</option>
                    </select>
                    <input type="text" id="note-topic" placeholder="논점 (예: 행정법 총론: 행정지도)" class="w-full p-2 border rounded-md" required>
                    <input type="text" id="note-keywords" placeholder="키워드 (쉼표로 구분)" class="w-full p-2 border rounded-md">
                    <textarea id="note-content" placeholder="정리 내용" rows="5" class="w-full p-2 border rounded-md"></textarea>
                    <input type="number" id="note-book-page" placeholder="기본서 페이지" class="w-full p-2 border rounded-md">
                </div>
                <div class="flex justify-end space-x-3 mt-4"> <!-- Buttons always at the bottom -->
                    <button type="button" onclick="closeModal('note-modal')" class="px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300">취소</button>
                    <button type="submit" class="px-4 py-2 bg-[#A37E63] text-white rounded-md hover:bg-[#8e6a51]">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="error-modal" class="fixed inset-0 z-50 modal-backdrop hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl">
            <form id="error-form" class="p-6 space-y-4">
                <h3 class="text-xl font-bold text-[#A37E63]">오답 노트 작성</h3>
                <div class="modal-content-area"> <!-- Scrollable content area -->
                    <input type="hidden" id="error-id">
                     <select id="error-subject" class="w-full p-2 border rounded-md" required>
                        <option value="">과목 선택</option>
                        <option>헌법</option> <option>행정법</option> <option>민법</option> <option>상법</option> <option>기초법학</option>
                    </select>
                    <input type="text" id="error-choice-summary" placeholder="선택지 내용 요약" class="w-full p-2 border rounded-md" required>
                    <textarea id="error-mistake-point" placeholder="착오 포인트 (왜 틀렸는지 분석)" rows="4" class="w-full p-2 border rounded-md"></textarea>
                    <textarea id="error-commentary" placeholder="해설 요약" rows="3" class="w-full p-2 border rounded-md"></textarea>
                </div>
                <div class="flex justify-end space-x-3 mt-4"> <!-- Buttons always at the bottom -->
                    <button type="button" onclick="closeModal('error-modal')" class="px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300">취소</button>
                    <button type="submit" class="px-4 py-2 bg-[#A37E63] text-white rounded-md hover:bg-[#8e6a51]">저장</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Detail View Modal -->
    <div id="detail-modal" class="fixed inset-0 z-50 modal-backdrop hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-3xl">
            <div id="detail-content" class="p-6 space-y-4 modal-content-area"></div> <!-- Scrollable content area -->
            <div class="flex justify-end p-4 bg-gray-50 rounded-b-lg"> <!-- Buttons always at the bottom -->
                <button type="button" onclick="closeModal('detail-modal')" class="px-4 py-2 bg-gray-200 rounded-md hover:bg-gray-300">닫기</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA & STATE MANAGEMENT ---
        let db = {
            notes: [],
            errors: [],
            reviewSchedule: [],
            reviewHistory: {}
        };

        const SUBJECTS = ['헌법', '행정법', '민법', '상법', '기초법학'];
        const CHART_COLORS = ['#B5947C', '#C8AB99', '#DBC3B5', '#E9DCD2', '#F1EAE4'];
        let charts = {};

        // --- CORE APP LOGIC ---
        document.addEventListener('DOMContentLoaded', () => {
            loadData();
            setupDDayCounter();
            renderAll();

            document.getElementById('note-form').addEventListener('submit', handleNoteFormSubmit);
            document.getElementById('error-form').addEventListener('submit', handleErrorFormSubmit);
        });

        function setupDDayCounter() {
            const examDate = new Date('2025-11-09T00:00:00');
            const today = new Date();
            today.setHours(0,0,0,0);
            const diffTime = examDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            document.getElementById('d-day-counter').textContent = `시험일까지 D-${diffDays}일`;
        }

        function renderAll() {
            renderTodayReview();
            renderNotesList();
            renderErrorsList();
            renderCharts();
        }

        function changeTab(tabName) {
            document.querySelectorAll('[data-tab]').forEach(button => button.classList.remove('active'));
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');

            ['dashboard', 'notes', 'errors'].forEach(id => {
                document.getElementById(id).classList.toggle('hidden', id !== tabName);
            });
        }

        // --- DATA PERSISTENCE (LocalStorage) ---
        function saveData() {
            try {
                localStorage.setItem('studyDashboardData', JSON.stringify(db));
                console.log('데이터가 로컬 스토리지에 성공적으로 저장되었습니다:', db);
            } catch (e) {
                console.error('로컬 스토리지 저장 실패:', e);
            }
        }

        function loadData() {
            try {
                const data = localStorage.getItem('studyDashboardData');
                if (data) {
                    db = JSON.parse(data);
                    console.log('데이터가 로컬 스토리지에서 성공적으로 로드되었습니다:', db);
                    // Ensure all necessary arrays/objects exist if they weren't explicitly saved
                    db.notes = db.notes || [];
                    db.errors = db.errors || [];
                    db.reviewSchedule = db.reviewSchedule || [];
                    db.reviewHistory = db.reviewHistory || {};
                } else {
                    console.log('로컬 스토리지에 데이터가 없습니다. 초기 더미 데이터로 시작합니다.');
                    db = {
                        notes: [
                            { id: 1, subject: '행정법', topic: '행정지도', keywords: '비구속적, 임의성', content: '행정절차법 제48조에 규정. 비권력적 사실행위. 행정지도는 행정기관이 그 소관 사무 범위에서 일정한 행위를 하거나 하지 아니하도록 지도, 권고, 조언 등을 하는 비권력적 사실행위이다. 행정절차법 제48조에 규정되어 있으며, 상대방의 임의적 협력을 요건으로 한다. 이는 강제성을 띠지 않으며, 법적 구속력을 가지지 않는다는 특징이 있다. 따라서 행정지도로 인해 어떤 손해가 발생하더라도 원칙적으로 법적 쟁송의 대상이 되지 않는다. 그러나 예외적으로 행정지도가 사실상 강제력을 띠거나, 법적 근거 없이 국민의 권익을 침해하는 경우 등에는 법적 분쟁의 대상이 될 수 있다. 예를 들어, 행정기관이 특정 사업자에게 부당하게 특정 행위를 요구하고, 이를 따르지 않을 경우 불이익을 주겠다고 위협하는 경우 등은 행정지도의 한계를 벗어나는 행위로 볼 수 있다. 이러한 경우 피해자는 해당 행정지도에 대해 행정심판이나 행정소송을 통해 권리 구제를 받을 수 있다. 또한, 행정지도는 행정의 효율성을 높이고 국민의 자발적인 협력을 유도하기 위한 수단이지만, 그 남용은 국민의 권익을 침해할 우려가 있으므로 신중하게 이루어져야 한다. 따라서 행정기관은 행정지도를 함에 있어서 그 목적을 명확히 하고, 상대방의 의사에 반하여 부당하게 강요해서는 안 된다는 점을 명심해야.', bookPage: 50, createdAt: new Date('2025-06-10').toISOString() },
                            { id: 2, subject: '헌법', topic: '기본권 제한', keywords: '과잉금지원칙', content: '목적의 정당성, 수단의 적합성, 침해의 최소성, 법익의 균형성.', bookPage: 25, createdAt: new Date('2025-06-12').toISOString() },
                        ],
                        errors: [
                            { id: 1, subject: '민법', choiceSummary: '의사표시는 항상 발신 시에 효력이 발생한다.', mistakePoint: '원칙(도달주의)과 예외(발신주의)를 혼동함.', commentary: '격지자 간 계약의 승낙 통지만 발신주의.', createdAt: new Date('2025-06-13').toISOString() },
                        ],
                        reviewSchedule: [
                            { type: 'note', id: 1, reviewCount: 1, nextReviewDate: '2025-06-11' },
                            { type: 'note', id: 2, reviewCount: 0, nextReviewDate: '2025-06-12' },
                            { type: 'error', id: 1, reviewCount: 0, nextReviewDate: '2025-06-13' },
                        ],
                        reviewHistory: { '2025-06-11': 1 }
                    };
                }
            } catch (e) {
                console.error('로컬 스토리지 로드 실패 또는 데이터 파싱 오류:', e);
                // Fallback to initial dummy data if loading fails entirely
                 db = {
                    notes: [
                        { id: 1, subject: '행정법', topic: '행정지도', keywords: '비구속적, 임의성', content: '행정절차법 제48조에 규정. 비권력적 사실행위. 행정지도는 행정기관이 그 소관 사무 범위에서 일정한 행위를 하거나 하지 아니하도록 지도, 권고, 조언 등을 하는 비권력적 사실행위이다. 행정절차법 제48조에 규정되어 있으며, 상대방의 임의적 협력을 요건으로 한다. 이는 강제성을 띠지 않으며, 법적 구속력을 가지지 않는다는 특징이 있다. 따라서 행정지도로 인해 어떤 손해가 발생하더라도 원칙적으로 법적 쟁송의 대상이 되지 않는다. 그러나 예외적으로 행정지도가 사실상 강제력을 띠거나, 법적 근거 없이 국민의 권익을 침해하는 경우 등에는 법적 분쟁의 대상이 될 수 있다. 예를 들어, 행정기관이 특정 사업자에게 부당하게 특정 행위를 요구하고, 이를 따르지 않을 경우 불이익을 주겠다고 위협하는 경우 등은 행정지도의 한계를 벗어나는 행위로 볼 수 있다. 이러한 경우 피해자는 해당 행정지도에 대해 행정심판이나 행정소송을 통해 권리 구제를 받을 수 있다. 또한, 행정지도는 행정의 효율성을 높이고 국민의 자발적인 협력을 유도하기 위한 수단이지만, 그 남용은 국민의 권익을 침해할 우려가 있으므로 신중하게 이루어져야 한다. 따라서 행정기관은 행정지도를 함에 있어서 그 목적을 명확히 하고, 상대방의 의사에 반하여 부당하게 강요해서는 안 된다는 점을 명심해야.', bookPage: 50, createdAt: new Date('2025-06-10').toISOString() },
                        { id: 2, subject: '헌법', topic: '기본권 제한', keywords: '과잉금지원칙', content: '목적의 정당성, 수단의 적합성, 침해의 최소성, 법익의 균형성.', bookPage: 25, createdAt: new Date('2025-06-12').toISOString() },
                    ],
                    errors: [
                        { id: 1, subject: '민법', choiceSummary: '의사표시는 항상 발신 시에 효력이 발생한다.', mistakePoint: '원칙(도달주의)과 예외(발신주의)를 혼동함.', commentary: '격지자 간 계약의 승낙 통지만 발신주의.', createdAt: new Date('2025-06-13').toISOString() },
                    ],
                    reviewSchedule: [
                        { type: 'note', id: 1, reviewCount: 1, nextReviewDate: '2025-06-11' },
                        { type: 'note', id: 2, reviewCount: 0, nextReviewDate: '2025-06-12' },
                        { type: 'error', id: 1, reviewCount: 0, nextReviewDate: '2025-06-13' },
                        ],
                    reviewHistory: { '2025-06-11': 1 }
                };
            }
        }

        // --- MODAL HANDLING ---
        function openModal(modalId, data = null) {
            const formId = modalId === 'note-modal' ? 'note-form' : 'error-form';
            document.getElementById(formId).reset();

            if (data) {
                 if (modalId === 'note-modal') {
                    document.getElementById('note-id').value = data.id;
                    document.getElementById('note-subject').value = data.subject;
                    document.getElementById('note-topic').value = data.topic;
                    document.getElementById('note-keywords').value = data.keywords;
                    document.getElementById('note-content').value = data.content;
                    document.getElementById('note-book-page').value = data.bookPage;
                } else if (modalId === 'error-modal') {
                    document.getElementById('error-id').value = data.id;
                    document.getElementById('error-subject').value = data.subject;
                    document.getElementById('error-choice-summary').value = data.choiceSummary;
                    document.getElementById('error-mistake-point').value = data.mistakePoint;
                    document.getElementById('error-commentary').value = data.commentary;
                }
            } else {
                 document.getElementById('note-id').value = '';
                 document.getElementById('error-id').value = '';
            }

            document.getElementById(modalId).classList.remove('hidden');
            document.getElementById(modalId).classList.add('flex');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
            document.getElementById(modalId).classList.remove('flex');
        }

        // --- FORM SUBMISSION HANDLERS ---
        function handleNoteFormSubmit(e) {
            e.preventDefault();
            const id = document.getElementById('note-id').value;
            const noteData = {
                id: id ? parseInt(id) : Date.now(),
                subject: document.getElementById('note-subject').value,
                topic: document.getElementById('note-topic').value,
                keywords: document.getElementById('note-keywords').value,
                content: document.getElementById('note-content').value,
                bookPage: document.getElementById('note-book-page').value,
                createdAt: id ? db.notes.find(n=>n.id==id).createdAt : new Date().toISOString()
            };

            if (id) { // Update
                db.notes = db.notes.map(n => n.id == id ? noteData : n);
                console.log('노트가 수정되었습니다:', noteData);
            } else { // Create
                db.notes.push(noteData);
                addReviewScheduleItem('note', noteData.id, noteData.createdAt);
                console.log('새 노트가 추가되었습니다:', noteData);
            }

            saveData();
            renderAll();
            closeModal('note-modal');
        }

        function handleErrorFormSubmit(e) {
            e.preventDefault();
            const id = document.getElementById('error-id').value;
            const errorData = {
                id: id ? parseInt(id) : Date.now(),
                subject: document.getElementById('error-subject').value,
                choiceSummary: document.getElementById('error-choice-summary').value,
                mistakePoint: document.getElementById('error-mistake-point').value,
                commentary: document.getElementById('error-commentary').value,
                createdAt: id ? db.errors.find(err=>err.id==id).createdAt : new Date().toISOString()
            };

            if (id) { // Update
                db.errors = db.errors.map(err => err.id == id ? errorData : err);
                console.log('오답 노트가 수정되었습니다:', errorData);
            } else { // Create
                db.errors.push(errorData);
                addReviewScheduleItem('error', errorData.id, errorData.createdAt);
                console.log('새 오답 노트가 추가되었습니다:', errorData);
            }

            saveData();
            renderAll();
            closeModal('error-modal');
        }

        // --- REVIEW LOGIC ---
        function addReviewScheduleItem(type, id, createdAt) {
            const today = new Date().toISOString().split('T')[0];
            db.reviewSchedule.push({
                type: type,
                id: id,
                createdAt: createdAt,
                reviewCount: 0,
                nextReviewDate: today
            });
            console.log('복습 스케줄에 항목이 추가되었습니다:', {type, id, nextReviewDate: today});
        }

        function markAsReviewed(type, id) {
            const itemIndex = db.reviewSchedule.findIndex(item => item.type === type && item.id === id);
            if (itemIndex === -1) return;

            const item = db.reviewSchedule[itemIndex];
            item.reviewCount += 1;

            const reviewIntervals = [1, 3, 7, 14, 30]; // Days from creation date
            const nextInterval = reviewIntervals[item.reviewCount-1];

            if(nextInterval) {
                const creationDate = new Date(item.createdAt);
                const nextDate = new Date(creationDate);
                nextDate.setDate(creationDate.getDate() + nextInterval);
                item.nextReviewDate = nextDate.toISOString().split('T')[0];
            } else {
                // After 30 days, just push it a month forward from last review
                const lastReviewDate = new Date();
                lastReviewDate.setDate(lastReviewDate.getDate() + 30);
                item.nextReviewDate = lastReviewDate.toISOString().split('T')[0];
            }

            const todayStr = new Date().toISOString().split('T')[0];
            db.reviewHistory[todayStr] = (db.reviewHistory[todayStr] || 0) + 1;

            console.log('항목 복습 완료 및 스케줄 업데이트:', item);
            saveData();
            renderAll();
        }

        // --- RENDER FUNCTIONS ---
        function renderTodayReview() {
            const listEl = document.getElementById('today-review-list');
            const today = new Date().toISOString().split('T')[0];
            const itemsToReview = db.reviewSchedule.filter(item => item.nextReviewDate <= today);

            if (itemsToReview.length === 0) {
                listEl.innerHTML = `<div class="text-center text-gray-500 p-4 bg-gray-50 rounded-lg">오늘 복습할 항목이 없습니다.</div>`;
                return;
            }

            listEl.innerHTML = itemsToReview.map(item => {
                const data = item.type === 'note'
                    ? db.notes.find(d => d.id === item.id)
                    : db.errors.find(d => d.id === item.id);
                if (!data) return '';

                const title = item.type === 'note' ? data.topic : data.choiceSummary;

                return `
                    <div class="bg-white p-4 rounded-lg shadow-sm flex justify-between items-center">
                        <div>
                            <span class="text-xs font-semibold ${item.type === 'note' ? 'text-blue-500 bg-blue-100' : 'text-red-500 bg-red-100'} px-2 py-1 rounded-full">${item.type === 'note' ? '노트' : '오답'}</span>
                            <span class="ml-3 font-medium">${title}</span>
                            <span class="text-sm text-gray-500 ml-2">(${data.subject}) - ${item.reviewCount}회 복습</span>
                        </div>
                        <button onclick="markAsReviewed('${item.type}', ${item.id})" class="px-3 py-1 bg-green-500 text-white text-sm rounded-lg hover:bg-green-600 transition">복습 완료</button>
                    </div>
                `;
            }).join('');
        }

        function renderList(type) {
            const listEl = document.getElementById(`${type}s-list`);
            const dataList = db[`${type}s`];

            if (dataList.length === 0) {
                listEl.innerHTML = `<div class="text-center text-gray-500 p-4">아직 추가된 ${type === 'note' ? '노트가' : '오답이'} 없습니다.</div>`;
                return;
            }

            listEl.innerHTML = dataList.map(data => {
                const title = type === 'note' ? data.topic : data.choiceSummary;
                return `
                    <div class="bg-white p-3 rounded-lg shadow-sm mb-2">
                        <div class="flex justify-between items-start">
                           <div class="flex-1">
                               <p class="font-semibold">${title}</p>
                               <p class="text-sm text-gray-500">${data.subject} | 생성: ${new Date(data.createdAt).toLocaleDateString()}</p>
                           </div>
                           <div class="flex space-x-2 ml-2">
                               <button onclick="viewDetail('${type}', ${data.id})" class="px-3 py-1 bg-blue-100 text-blue-600 text-xs rounded-md hover:bg-blue-200">보기</button>
                               <button onclick="openModal('${type}-modal', db.${type}s.find(d=>d.id==${data.id}))" class="px-3 py-1 bg-yellow-100 text-yellow-600 text-xs rounded-md hover:bg-yellow-200">수정</button>
                               <button onclick="deleteItem('${type}', ${data.id})" class="px-3 py-1 bg-red-100 text-red-600 text-xs rounded-md hover:bg-red-200">삭제</button>
                           </div>
                        </div>
                    </div>
                `
            }).join('');
        }

        function renderNotesList() { renderList('note'); }
        function renderErrorsList() { renderList('error'); }

        function deleteItem(type, id) {
            if (!confirm('정말로 삭제하시겠습니까? 관련된 복습 스케줄도 함께 삭제됩니다.')) return;

            db[`${type}s`] = db[`${type}s`].filter(item => item.id !== id);
            db.reviewSchedule = db.reviewSchedule.filter(item => !(item.type === type && item.id === id));

            console.log('항목이 삭제되었습니다:', {type, id});
            saveData();
            renderAll();
        }

        function viewDetail(type, id) {
            const data = db[`${type}s`].find(d => d.id === id);
            const contentEl = document.getElementById('detail-content');

            let html = `
                <h3 class="text-xl font-bold text-[#A37E63]">${type === 'note' ? '노트 상세' : '오답 상세'}</h3>
                <p><strong class="w-24 inline-block">과목:</strong> ${data.subject}</p>
                <p><strong class="w-24 inline-block">생성일:</strong> ${new Date(data.createdAt).toLocaleDateString()}</p>
            `;

            if (type === 'note') {
                html += `
                    <p><strong class="w-24 inline-block">논점:</strong> ${data.topic}</p>
                    <p><strong class="w-24 inline-block">키워드:</strong> <span class="bg-gray-100 px-2 py-1 rounded">${data.keywords}</span></p>
                    <p><strong class="w-24 inline-block">기본서 페이지:</strong> ${data.bookPage || 'N/A'}</p>
                    <div class="mt-4 p-4 bg-gray-50 rounded-md">
                        <strong class="block mb-2">정리 내용:</strong>
                        <p class="whitespace-pre-wrap">${data.content}</p>
                    </div>
                `;
            } else {
                 html += `
                    <p><strong class="w-24 inline-block">선택지:</strong> ${data.choiceSummary}</p>
                    <div class="mt-4 p-4 bg-red-50 rounded-md">
                        <strong class="block mb-2 text-red-700">착오 포인트:</strong>
                        <p class="whitespace-pre-wrap">${data.mistakePoint}</p>
                    </div>
                     <div class="mt-2 p-4 bg-blue-50 rounded-md">
                        <strong class="block mb-2 text-blue-700">해설 요약:</strong>
                        <p class="whitespace-pre-wrap">${data.commentary}</p>
                    </div>
                `;
            }
            contentEl.innerHTML = html;
            openModal('detail-modal');
        }

        // --- CHART RENDERING ---
        function renderCharts() {
            renderSubjectChart();
            renderErrorChart();
            renderReviewHistoryChart();
        }

        function renderSubjectChart() {
            const ctx = document.getElementById('subjectChart').getContext('2d');
            const data = {
                labels: SUBJECTS,
                datasets: [{
                    label: '과목별 노트 수',
                    data: SUBJECTS.map(s => db.notes.filter(n => n.subject === s).length),
                    backgroundColor: CHART_COLORS,
                    borderColor: '#FDFBF7',
                    borderWidth: 2
                }]
            };

            if (charts.subject) charts.subject.destroy();
            charts.subject = new Chart(ctx, {
                type: 'doughnut',
                data: data,
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'top' } } }
            });
        }

        function renderErrorChart() {
            const ctx = document.getElementById('errorChart').getContext('2d');
            const data = {
                labels: SUBJECTS,
                datasets: [{
                    label: '과목별 오답 수',
                    data: SUBJECTS.map(s => db.errors.filter(e => e.subject === s).length),
                    backgroundColor: CHART_COLORS[0],
                }]
            };

            if (charts.error) charts.error.destroy();
            charts.error = new Chart(ctx, {
                type: 'bar',
                data: data,
                options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', plugins: { legend: { display: false } } }
            });
        }

        function renderReviewHistoryChart() {
            const ctx = document.getElementById('reviewHistoryChart').getContext('2d');
            const labels = [];
            const dataPoints = [];
            const today = new Date();
            for(let i=14; i>=0; i--) {
                const date = new Date(today);
                date.setDate(today.getDate() - i);
                const dateString = date.toISOString().split('T')[0];
                labels.push(`${date.getMonth()+1}/${date.getDate()}`);
                dataPoints.push(db.reviewHistory[dateString] || 0);
            }

            const data = {
                labels: labels,
                datasets: [{
                    label: '일별 복습 완료 수',
                    data: dataPoints,
                    fill: true,
                    borderColor: CHART_COLORS[0],
                    backgroundColor: CHART_COLORS[2],
                    tension: 0.1
                }]
            };
            if(charts.history) charts.history.destroy();
            charts.history = new Chart(ctx, {
                type: 'line',
                data: data,
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } } }
            });
        }

    </script>
</body>
</html>
�
